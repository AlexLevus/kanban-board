!function(t){var e={};function n(r){if(e[r])return e[r].exports;var a=e[r]={i:r,l:!1,exports:{}};return t[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(r,a,function(e){return t[e]}.bind(null,a));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=4)}([function(t,e,n){var r=n(1),a=n(2);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[t.i,a,""]]);var s={insert:"head",singleton:!1},i=(r(a,s),a.locals?a.locals:{});t.exports=i},function(t,e,n){"use strict";var r,a=function(){return void 0===r&&(r=Boolean(window&&document&&document.all&&!window.atob)),r},s=function(){var t={};return function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}t[e]=n}return t[e]}}(),i=[];function o(t){for(var e=-1,n=0;n<i.length;n++)if(i[n].identifier===t){e=n;break}return e}function d(t,e){for(var n={},r=[],a=0;a<t.length;a++){var s=t[a],d=e.base?s[0]+e.base:s[0],c=n[d]||0,l="".concat(d," ").concat(c);n[d]=c+1;var u=o(l),p={css:s[1],media:s[2],sourceMap:s[3]};-1!==u?(i[u].references++,i[u].updater(p)):i.push({identifier:l,updater:b(p,e),references:1}),r.push(l)}return r}function c(t){var e=document.createElement("style"),r=t.attributes||{};if(void 0===r.nonce){var a=n.nc;a&&(r.nonce=a)}if(Object.keys(r).forEach((function(t){e.setAttribute(t,r[t])})),"function"==typeof t.insert)t.insert(e);else{var i=s(t.insert||"head");if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(e)}return e}var l,u=(l=[],function(t,e){return l[t]=e,l.filter(Boolean).join("\n")});function p(t,e,n,r){var a=n?"":r.media?"@media ".concat(r.media," {").concat(r.css,"}"):r.css;if(t.styleSheet)t.styleSheet.cssText=u(e,a);else{var s=document.createTextNode(a),i=t.childNodes;i[e]&&t.removeChild(i[e]),i.length?t.insertBefore(s,i[e]):t.appendChild(s)}}function f(t,e,n){var r=n.css,a=n.media,s=n.sourceMap;if(a?t.setAttribute("media",a):t.removeAttribute("media"),s&&btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),t.styleSheet)t.styleSheet.cssText=r;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(r))}}var g=null,h=0;function b(t,e){var n,r,a;if(e.singleton){var s=h++;n=g||(g=c(e)),r=p.bind(null,n,s,!1),a=p.bind(null,n,s,!0)}else n=c(e),r=f.bind(null,n,e),a=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(n)};return r(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;r(t=e)}else a()}}t.exports=function(t,e){(e=e||{}).singleton||"boolean"==typeof e.singleton||(e.singleton=a());var n=d(t=t||[],e);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var r=0;r<n.length;r++){var a=o(n[r]);i[a].references--}for(var s=d(t,e),c=0;c<n.length;c++){var l=o(n[c]);0===i[l].references&&(i[l].updater(),i.splice(l,1))}n=s}}}},function(t,e,n){(e=n(3)(!1)).push([t.i,"html,\nbody {\n  height: 100vh;\n}\n\nbody {\n  background-color: rgb(0, 121, 191);\n  overflow: hidden;\n}\n\n* {\n  margin: 0;\n  padding: 0;\n  outline: none;\n}\n\ntextarea {\n  display: block;\n  width: 100%;\n  box-sizing: border-box;\n\n  border: none;\n  resize: none;\n  cursor: pointer;\n  background: transparent;\n\n  font-family: inherit;\n  font-size: 14px;\n  line-height: 20px;\n\n  overflow: hidden;\n  overflow-wrap: break-word;\n}\n\n.page {\n  overflow-x: auto;\n}\n\n.page__main {\n  display: flex;\n  width: max-content;\n  margin-top: 8px;\n}\n\n.list {\n  height: 95vh;\n\n  display: block;\n  border-radius: 3px;\n  width: 275px;\n  margin: 0 4px;\n  padding-bottom: 10px;\n\n  font-family: Montserrat;\n}\n\n.list:first-child {\n  margin-left: 8px;\n}\n\n.list:last-child {\n  margin-right: 8px;\n}\n\n.list-name {\n  height: 28px;\n  width: 90%;\n  max-height: 256px;\n  min-height: 20px;\n\n  margin: 2px 0;\n  padding: 4px 8px;\n  margin: 0 6px;\n\n  border-radius: 3px;\n\n  font-weight: bold;\n  color: #000000;\n}\n\n.list-name:focus {\n  background: #fff;\n  border: none;\n  box-shadow: inset 0 0 0 2px #0079bf;\n}\n\n::placeholder {\n  font-size: 13px\n}\n\n.list__container {\n  padding: 10px 4px;\n  padding-top: 0;\n\n  background: #dfe3e6;\n  border-radius: 3px;\n  box-sizing: border-box;\n  display: flex;\n  flex-direction: column;\n  max-height: 100%;\n}\n\n.list__header {\n  display: flex;\n  padding: 5px;\n  margin-right: 6px;\n}\n\n.list__content {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  overflow-y: auto;\n  overflow-x: hidden;\n}\n\n.list__footer {\n  display: flex;\n  padding: 0 10px;\n  cursor: pointer;\n}\n\n.list__footer_hover:hover {\n  background-color: #d5d6e0;\n  border-radius: 3px;\n}\n\n.card {\n  display: flex;\n  width: 100%;\n  max-width: 250px;\n  color: #000000;\n  background: #ffffff;\n  box-shadow: 0px 1px 4px rgba(9, 45, 66, 0.25);\n  border-radius: 3px;\n  cursor: pointer;\n  margin-bottom: 8px;\n}\n\n.card:hover {\n  background-color: #f4f5f7;\n}\n\n.card__text {\n  padding: 8px 12px;\n  font-size: 13px;\n  line-height: 19px;\n  white-space: normal;\n}\n\n.card__text_add {\n  padding: 4px 8px;\n  font-size: 14px;\n  font-weight: bold;\n  color: #000000;\n}\n\n.card__text:focus {\n  background: #fff;\n  border: none;\n  box-shadow: inset 0 0 0 2px #0079bf;\n}\n\n.btn {\n  font-family: inherit;\n  font-size: 13px;\n  line-height: 19px;\n  color: #6b808c;\n  background-color: inherit;\n  border: none;\n  text-align: center;\n  display: inline-block;\n  cursor: pointer;\n}\n\n.btn-icon::before {\n  font-family: 'Times New Roman';\n  font-size: 24px;\n  margin-right: 5px;\n  content: '+';\n}\n\n.btn-add {\n  border-radius: 3px;\n  padding: 8px 14px;\n  color: #fff;\n  background-color: #5aac44;\n}\n\n.btn-add:hover {\n  background-color: #61bd4f;\n}\n\n.btn-close {\n  height: 30px;\n  font-family: 'Times New Roman';\n  font-size: 40px;\n  transform: rotate(45deg);\n  background-color: transparent;\n}\n\n.btn-card {\n  height: 35px;\n  font-size: 34px;\n  margin: 0 6px;\n}\n\n.btn-close:hover {\n  color: #172b4d;\n}\n\n.form {\n  width: 100%;\n}\n\n.form__actions {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n}\n\n::-webkit-scrollbar {\n  width: 8px;\n  height: 14px;\n  border-radius: 10px;\n  background: rgb(0, 121, 191, 0.3);\n}\n\n::-webkit-scrollbar-track {\n  background: rgba(218, 219, 226, 0.548);\n  border-radius: 10px;\n}\n\n::-webkit-scrollbar-thumb {\n  background: rgb(219, 145, 145);\n  border-radius: 10px;\n}\n\n::-webkit-scrollbar-thumb:hover {\n  background: rgb(230, 115, 115);\n}\n\n::-webkit-scrollbar-button:horizontal {\n  display: block;\n  height: 4px;\n  width: 4px;\n}\n\n.hide {\n  opacity: 0.6;\n}\n\n.drag-hovered {\n  background-color: #d1d8d2;\n}\n\n.card-drag {\n  cursor: grabbing;\n}\n\n.list__container_hover {\n  padding: 4px;\n}\n\n.list__container_hover:hover {\n  background-color: #d5d6e0;\n  padding: 4px;\n}\n\n.list-drag-enter::after {\n\n}\n\n.list-drag-enter {\n  background-color: tomato;\n}\n\n.hovered {\n  background-color: lightblue;\n  box-shadow: 3px 3px 4px rgba(135, 115, 105, 0.49)\n}\n\n#drop * {pointer-events: none;}\n",""]),t.exports=e},function(t,e,n){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n=function(t,e){var n=t[1]||"",r=t[3];if(!r)return n;if(e&&"function"==typeof btoa){var a=(i=r,o=btoa(unescape(encodeURIComponent(JSON.stringify(i)))),d="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(o),"/*# ".concat(d," */")),s=r.sources.map((function(t){return"/*# sourceURL=".concat(r.sourceRoot||"").concat(t," */")}));return[n].concat(s).concat([a]).join("\n")}var i,o,d;return[n].join("\n")}(e,t);return e[2]?"@media ".concat(e[2]," {").concat(n,"}"):n})).join("")},e.i=function(t,n,r){"string"==typeof t&&(t=[[null,t,""]]);var a={};if(r)for(var s=0;s<this.length;s++){var i=this[s][0];null!=i&&(a[i]=!0)}for(var o=0;o<t.length;o++){var d=[].concat(t[o]);r&&a[d[0]]||(n&&(d[2]?d[2]="".concat(n," and ").concat(d[2]):d[2]=n),e.push(d))}},e}},function(t,e,n){"use strict";function r(t){const e=t.reduce((t,e)=>[...t,...e.tasks],[]);return Math.max(...e.map(t=>t.id))+1}function a(t){return Math.max(...t.map(t=>t.id))+1}function s(t){return Array.prototype.indexOf.call(t.parentNode.children,t)}n.r(e);class i{static getState(){return JSON.parse(localStorage.getItem("lists")||"[]")}static setState(t){localStorage.setItem("lists",JSON.stringify(t))}static addCardToState(t,e){const n=i.getState(),a={days:0,desc:"",end_date:null,id:r(n),isDone:!1,isStarted:!1,name:e,start_date:null},[s]=n.filter(e=>e.id===t);s.tasks=[...s.tasks,a],i.setState(n)}static addListToState(t){const e=i.getState(),n={arrange:e.length+1,id:a(e),name:t,tasks:[],tasks_count:0};e.push(n),i.setState(e)}static deleteListFromState(t){const e=i.getState().filter(e=>e.id!==t);i.setState(e)}static deleteCardFromState(t){const e=i.getState(),n=e.find(e=>e.tasks.some(e=>e.id===t)),r=n.tasks.filter(e=>e.id!==t);e[n.arrange-1].tasks=r,i.setState(e)}}class o{constructor(t){this.baseUrl=t,this.postOptions={method:"POST",headers:{"Content-Type":"application/json"}}}async getData(){const t=(await fetch(this.baseUrl+"get_tasks")).json();t.then(t=>{localStorage.setItem("lists",JSON.stringify(t.panels))})}async createList(t){const e={status_name:t};i.addListToState(t);const n=await fetch(this.baseUrl+"create_status",{...this.postOptions,body:JSON.stringify(e)});return await n.json()}async renameList(t,e){const n={status_name:e,id:t},r=await fetch(this.baseUrl+"rename_status",{...this.postOptions,body:JSON.stringify(n)});return await r.json()}async deleteList(t){const e={id:t};i.deleteListFromState(t);const n=await fetch(this.baseUrl+"delete_status",{...this.postOptions,body:JSON.stringify(e)});return await n.json()}async moveList(t,e){const n={id:t,index:e},r=await fetch(this.baseUrl+"move_panel",{...this.postOptions,body:JSON.stringify(n)});return await r.json()}async createCard(t,e,n){const r={name:t,desc:e,status_id:n};i.addCardToState(n,t);const a=await fetch(this.baseUrl+"create_task",{...this.postOptions,body:JSON.stringify(r)});return await a.json()}async renameCard(t,e){const n={name:e,task_id:t},r=await fetch(this.baseUrl+"rename_task",{...this.postOptions,body:JSON.stringify(n)});return await r.json()}async deleteCard(t){const e={task_id:t};i.deleteCardFromState(t);const n=await fetch(this.baseUrl+"delete_task",{...this.postOptions,body:JSON.stringify(e)});return await n.json()}async moveCard(t,e){const n={task_id:t,status_id:e},r=await fetch(this.baseUrl+"move_task",{...this.postOptions,body:JSON.stringify(n)});return await r.json()}}const d=new o("https://perpower.ru/tasks/");class c{static dragStart(t){if(t.stopPropagation(),"DIV"!==t.target.tagName)return t.preventDefault(),!1;const e=this.parentElement.id,n=this.classList.contains("list")?"list":"card";t.dataTransfer.setData("text/plain",t.target.id),t.dataTransfer.setData("parentListId",e),t.dataTransfer.setData("elementType",n),setTimeout(()=>{if(this.classList.add("hide"),"list"===n){this.querySelector(".list__container").classList.add("list-drag-hover")}})}static dragEnd(t){const e=document.querySelector(".hovered");e&&e.classList.remove("hovered"),this.classList.remove("hide"),this.classList.remove("list-drag-hover")}static dragOver(t){t.preventDefault()}static dragEnter(t){this.classList.add("hovered")}static dragLeave(t){this.classList.remove("hovered")}static dragDropList(t){const e=t.dataTransfer.getData("text/plain"),n=document.getElementById(e),r=t.dataTransfer.getData("parentListId"),a=t.dataTransfer.getData("elementType"),i=this.querySelector(".list__content"),o=+e.split(a)[1],c=+this.id.split("list")[1];if("card"===a&&i&&r!==i.id&&(i.appendChild(n),d.moveCard(o,c)),"list"===a){const t=this.parentElement,e=s(n);s(this)>e?t.insertBefore(n,this.nextSibling):t.insertBefore(n,this),o!==c&&d.moveList(o,c)}}static dragDropCard(t){if("card"===t.dataTransfer.getData("elementType")){t.stopPropagation();const e=t.dataTransfer.getData("text/plain"),n=document.getElementById(e),r=this.parentElement,a=s(n);s(this)>a?r.insertBefore(n,this.nextSibling):r.insertBefore(n,this);const i=e.split("card")[1],o=this.id.split("card")[1],c=r.id.split("list")[1];i!==o&&d.moveCard(i,c)}}}const l=new o("https://perpower.ru/tasks/");class u{static renderLists(t,e){L();const n=i.getState().map(({id:t,name:n,tasks:r,arrange:a})=>`\n          <div id="list${t}" class="list" draggable="true">\n            <div class="list__container">\n              ${f(t,n)}\n              ${g(t,r)}\n              ${h(t,a,e)}\n            </div>\n          </div>`).join("");document.getElementById("root").innerHTML=n+m,e&&u.renderAddNewCardForm(e),u.setForNewListListeners(),u.setFooterListeners(t),u.setDeleteListeners(),u.setTextareaListeners(),u.setDragAndDropListeners()}static addNewCard(t,e){return n=>{u.renderLists(t,+e)}}static setDragAndDropListeners(){const t=document.querySelectorAll(".list[draggable=true]");document.querySelectorAll(".card").forEach(t=>{t.addEventListener("dragstart",c.dragStart),t.addEventListener("dragend",c.dragEnd),t.addEventListener("drop",c.dragDropCard)}),t.forEach(t=>{t.addEventListener("dragstart",c.dragStart),t.addEventListener("dragover",c.dragOver),t.addEventListener("dragend",c.dragEnd),t.addEventListener("drop",c.dragDropList)})}static setFooterListeners(t){document.querySelectorAll("#footer").forEach(x(t))}static setTextareaListeners(){const t=document.querySelectorAll(".js-text");t.forEach(_),t.forEach(j)}static setDeleteListeners(){document.querySelectorAll(".js-delete").forEach(E)}static setForNewListListeners(){document.querySelector(".list__container_hover").addEventListener("click",S,!0)}static renderAddNewCardForm(t){const e=document.getElementById("btn-add"),n=document.getElementById("btn-close");e.addEventListener("click",k(t)),n.addEventListener("click",()=>u.renderLists()),w(t),setTimeout(()=>{document.addEventListener("click",y)})}}const p=({id:t,name:e})=>`\n  <div id="card${t}" class="card" draggable="true">\n    <textarea id="${t}" type="text" class="card__text js-text js-card-text" placeholder="Введите название карточки" required>${e}</textarea>\n    <button id="${t}" type="button" class="btn btn-close btn-card js-delete js-delete-card">+</button>\n  </div>\n`,f=(t,e)=>`\n  <div class="list__header">\n    <textarea\n      class="list-name js-text js-header-text"\n      placeholder="Введите название колонки"\n      ondragstart="return false"\n      id="${t}"\n      maxlength="250">${e}</textarea>\n      <button id="${t}" type="button" class="btn btn-close js-delete js-delete-list">+</button>\n  </div>\n  `,g=(t,e)=>`\n  <div id="list${t}" class="list__content">\n    ${e.map(p).join("")}\n  </div>\n  `,h=(t,e,n)=>`\n  <div id="footer" class="${"list__footer "+(n?"":"list__footer_hover")}" data-list-id="${t}">\n    ${t===n?v():b(t,e)}\n  </div>`,b=(t,e)=>`\n  <span class="btn-icon"></span>\n  <button type="button" class="btn" data-list-id="${t}" data-arrange="${e}" id="add-btn">\n    Добавить карточку\n  </button>\n  `,m='\n  <div class="list">\n    <div class="list__container list__container_hover">\n      <div id="new-list-container" class="list__footer">\n        <span class="btn-icon"></span>\n        <button id="btn-list-add" type="button" class="btn">Добавить колонку</button>\n      </div>\n    </div>\n  </div>\n  ',v=()=>'\n    <div id="form" class="form">\n      <div class="card card__add-form">\n        <textarea type="text" id="add-textarea" class="card__text" maxlength="250" placeholder="Введите название карточки"\n        autofocus required></textarea>\n      </div>\n      <div class="form__actions">\n        <button id="btn-add" type="submit" class="btn btn-add">Добавить карточку</button>\n        <button id="btn-close" type="button" class="btn btn-close">+</button>\n      </div>\n    </div>\n  ',x=t=>(e,n)=>{t!==n+1&&e.addEventListener("click",u.addNewCard(n+1,e.dataset.listId))},y=t=>{const e=document.getElementById("form");e&&!e.contains(t.target)&&"add-btn"!==t.target.id&&u.renderLists()},_=t=>{t.style.height="1px",t.style.height=t.scrollHeight+"px",t.addEventListener("input",t=>{const e=t.target;e.style.height="1px",e.style.height=e.scrollHeight+"px"})},L=()=>{document.removeEventListener("click",y)},w=t=>{const e=document.getElementById("add-textarea");e.focus(),_(e),e.addEventListener("keydown",e=>{const{value:n}=e.target;13===e.keyCode&&(e.preventDefault(),""!==n&&(l.createCard(n,"",t),u.renderLists()))})},k=t=>e=>{const n=document.getElementById("add-textarea");n.focus();const{value:r}=n;r&&(l.createCard(r,"",t),u.renderLists())},S=t=>{document.getElementById("new-list-container").innerHTML='\n    <div id="form" class="form">\n      <div class="card card__add-form">\n        <textarea type="text" id="add-list-textarea" class="card__text card__text_add" maxlength="250" placeholder="Введите название колонки"\n        autofocus required></textarea>\n      </div>\n      <div class="form__actions">\n        <button id="btn-add-list" type="submit" class="btn btn-add">Добавить колонку</button>\n        <button id="btn-close-list" type="button" class="btn btn-close">+</button>\n      </div>\n    </div>\n  ';const e=document.getElementById("btn-add-list"),n=document.getElementById("btn-close-list"),r=document.getElementById("add-list-textarea");r.focus(),r.style.height="1px",r.style.height=r.scrollHeight+"px",e.addEventListener("click",t=>{const{value:e}=r;e&&(l.createList(e),u.renderLists())}),r.addEventListener("input",t=>{const e=t.target;e.style.height="1px",e.style.height=e.scrollHeight+"px"}),r.addEventListener("keydown",t=>{const{value:e}=t.target;13===t.keyCode&&(t.preventDefault(),""!==e&&(l.createList(e),u.renderLists()))}),n.addEventListener("click",()=>u.renderLists()),document.addEventListener("click",y,!0)},E=t=>{t.addEventListener("click",t=>{const{id:e,classList:n}=t.target;((t,e)=>{"card"===t?l.deleteCard(+e):l.deleteList(+e)})(n.contains("js-delete-card")?"card":"list",e),u.renderLists()})},j=t=>{t.addEventListener("blur",t=>{const{value:e,defaultValue:n,classList:r}=t.target,a=r.contains("js-card-text")?"card":"list";if(e&&e!==n){const{id:n}=t.target;((t,e,n)=>{"card"===t?l.renameCard(e,n):l.renameList(e,n)})(a,n,e)}else""===e&&(t.target.value=n)}),t.addEventListener("keydown",t=>{13===t.keyCode&&(t.preventDefault(),t.target.blur())})};n(0);const C=new o("https://perpower.ru/tasks/");window.addEventListener("load",()=>{C.getData(),u.renderLists()})}]);